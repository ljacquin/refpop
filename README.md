[<img src="img/refpop.png"/>]()

# refpop
[![R Badge](https://img.shields.io/badge/R-276DC3?style=for-the-badge&logo=r&logoColor=white)](https://www.r-project.org/)
[![Shell Script Badge](https://img.shields.io/badge/Shell_Script-121011?style=for-the-badge&logo=gnu-bash&logoColor=white)](https://en.wikipedia.org/wiki/Bash_(Unix_shell))
[![Python Badge](https://img.shields.io/badge/Python-FFD43B?style=for-the-badge&logo=python&logoColor=blue)](https://www.python.org/)
[![Plotly Badge](https://img.shields.io/badge/Plotly-239120?style=for-the-badge&logo=plotly&logoColor=white)](https://plotly.com/)
[![RStudio Badge](https://img.shields.io/badge/RStudio-75AADB?style=for-the-badge&logo=RStudio&logoColor=white)](https://www.rstudio.com/)

## Objective, tasks & analyses, and instructions :

### üéØ Objective

This repository hosts ```R``` scripts designed to ensure reproducible data analysis and results, aimed at characterizing the refpop population, according to the FAIR principles defined as follows :

* **F**indable

* **A**ccessible

* **I**nteroperable

* **R**eusable

### üìä Tasks & analyses 

#### üìÇ Repository overview

The ```refpop``` repository hosts ```R``` scripts that aim to automate the following tasks and analyses to the best of their ability:

* **Phenotype outlier detection**: Intended to automatically produce a clean phenotype dataset, i.e., one that is free of outliers, using robust multivariate and knowledge-based rule methods

* **Spatial heterogeneity correction**: Aims to address spatial heterogeneity for each trait in the cleaned phenotype dataset, and then identify environments with low heritability using a robust univariate outlier detection method and exclude these for further analysis. For each trait, heritability distributions across all environments are computed before and after spatial heterogeneity correction; these distributions are also computed by management type

* **Adjusted ls-means computation**: Focuses on computing the adjusted phenotypic ls-means for each genotype across environments, using the adjusted phenotypes obtained from spatial heterogeneity correction in each environment

* **Data structure inference**: Focuses on inferring the genomic, phenotypic, and pedigree data structures of the refpop population

* **Genomic prediction accuracy evaluation**: Seeks to evaluate, for each trait, the genomic prediction accuracy for the adjusted phenotypic ls-means based on the genomic data

* **G x E x M evaluation**: Directed towards evaluating, for each trait, the interactions between genotypes, their environments and management types

#### ‚îî üìÅ Repository details 
The ```refpop``` repository contains three main folders that are central to the tasks and analyses performed by the ```refpop``` ```R``` scripts:

* ```src```: Houses the ```R``` scripts

* ```data```: Contains the data sourced, processed and analyzed by the ```R``` scripts. Note that some processed data, such as the clean phenotype dataset for example, are written and stored in this folder

* ```results```: Stores the results generated by the ```R``` script tasks and analyses

Furthermore, the ```R``` scripts in ```src``` are distributed accross several subfolders: ```refpop_data_structure_analysis```, ```refpop_data_treatment_and_analysis```, ```refpop_gem_interaction_analysis``` and ```refpop_predictive_modeling_and_analysis```. These folders are organized according to the specific tasks and analyses performed by the user, such as general data treatment and analyses like outlier identification and removal, spatial heterogeneity correction, and adjusted ls-means, as well as more specialized tasks like genomic prediction modeling and analysis, etc.

##### üß© Interdependencies of scripts for analyses

Most scripts rely on the preprocessed data generated by the scripts in ```refpop_data_treatment_and_analysis```. Therefore, it is strongly recommended to execute the data treatment steps first before proceeding with any further analyses. Otherwise, there are no interdependencies between the ```R``` scripts.

##### üìú Details of scripts analyses

The analyses performed by the different ```R``` scripts in the subfolders of ```src``` are described as follows:

* ```refpop_data_treatment_and_analysis```
  * ```refpop_0_phenotype_outlier_detection_per_env.R```: Conducts outlier detection for phenotypes using two methods.  
  The first method employs robust multivariate outlier detection, which  considers the covariance structure among phenotypic measurements of traits. This method utilizes the Mahalanobis distance (MD) with the minimum covariance determinant (MCD) estimator to mitigate contamination points (i.e., outliers) during the detection process. Given that MD can be sensitive to the curse of dimensionality - resulting in diminished outlier detection accuracy with an increasing number of variables - a principal component analysis is performed beforehand to reduce dimensionality.  
  The second approach is a knowledge-based rule method which considers the following set of criteria :
    *
    *
  
  * ```refpop_1_spat_hetero_correct_per_env_trait_and_h2_estim.R```:
  * ```refpop_2_adjusted_lsmeans_phenotype.R```:
  
* ```refpop_data_structure_analysis```
  * ```refpop_genomic_data_structure_analysis.R```:
  * ```refpop_pedigree_and_phenotype_data_structure_analysis.R```:
  
* ```refpop_gem_interaction_analysis```
  * ```script_1.R```:
  * ```script_2.R```:

* ```refpop_predictive_modeling_and_analysis```
  * ```refpop_genomic_prediction_and_analysis_trait.R```:

### üíª Instructions

